<html>
  <head>
    <title>Afterschool Activities</title>
    <link rel="stylesheet" href="app.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
    />
    <script src="https://unpkg.com/vue@2.7.8/dist/vue.js"></script>
    <script src="lessons.js"></script>
  </head>
  <body>
    <div id="app">
      <header>
        <h1 v-text="sitename"></h1>
        <button v-if="canSwitchPages()" v-on:click="showCheckout">
          {{ cartItemCount }}
          <span class="fas fa-cart-plus"></span>
          Checkout
        </button>
        
        <button v-else disabled>
          {{ cartItemCount }}
          <span class="fas fa-cart-plus"></span>
          Checkout
        </button>

      </header>

      <div v-if="showLessons">
        <main>
          <!-- Sorting and ordering section -->
          <div>
            <p>Sort items by:</p>
            <button v-on:click="selectSortingOption('subject')">
              <span class="fas fa-book"></span>
              Subject
            </button>

            <button v-on:click="selectSortingOption('location')">
              <span class="fas fa-map-pin"></span>
              Location
            </button>

            <button v-on:click="selectSortingOption('price')">
              <span class="fas fa-coins"></span>
              Price
            </button>

            <button v-on:click="selectSortingOption('space')">
              <span class="fas fa-check"></span>
              Available space
            </button>

            <p>Order:</p>

            <button v-on:click="setAscendingOrder">
              <span class="fas fa-arrow-up"></span>
              Ascending
            </button>

            <button v-on:click="setDescendingOrder">
              <span class="fas fa-arrow-down"></span>
              Descending
            </button>
          </div>

          <div v-for="lesson in sortedLessons">
            <figure>
              <img
                v-bind:src="lesson.image"
                v-bind:alt="lesson.imageFileText"
                class="lessonImage"
              />
            </figure>
            <h2 v-text="lesson.subject"></h2>
            <p v-text="lesson.description"></p>
            <p v-text="lesson.location"></p>
            <p>Price: {{ lesson.price }}</p>
            <button v-if="canAddToCart(lesson)" v-on:click="addToCart(lesson)">
              Add to cart
            </button>
            <button v-else disabled>Add to cart</button>

            <span v-if="lessonSpacesLeft(lesson) === 0">All out!</span>
            <span v-else-if="lessonSpacesLeft(lesson) < 5">
              Only {{ lessonSpacesLeft(lesson) }} left!</span
            >
            <span v-else>Buy now!</span>

            <div>
              <span v-for="n in lesson.rating">★</span>
              <span v-for="n in 5 - lesson.rating">☆</span>
            </div>
          </div>
        </main>
      </div>

      <!-- Checkout page -->

      <div v-else>
        <h1>Welcome to the checkout page</h1>
        <p>
          <strong>Name: </strong>
          <input type="text" v-model.trim="order.name" />
        </p>

        <p>
          <strong>Surname: </strong>
          <input type="text" v-model.trim="order.surname" />
        </p>

        <p>
          <strong>State: </strong>
          <select v-model="order.state">
            <option disabled>SelectState</option>
            <option v-for="(state, key) in states" v-bind:value="state">
              {{ key }}
            </option>
          </select>
        </p>

        <p>
          <strong>Zip/Postal Code: </strong>
          <input type="number" v-model.number="order.zip" />
        </p>

        <p>
          <input
            type="checkbox"
            id="gift"
            v-model="order.gift"
            v-bind:true-value="order.sendGift"
            v-bind:false-value="order.dontSendGift"
          />
          <label for="gift">Send as a gift?</label>
        </p>
        <p>
          <input type="radio" id="home" value="Home" v-model="order.method" />
          <label for="home">Home</label>
          <input
            type="radio"
            id="business"
            value="Business"
            v-model="order.method"
          />
          <label for="business">Business</label>
        </p>
        <h2>Order Information</h2>
        <p><strong>Name:</strong> {{ order.name }}</p>
        <p><strong>Surname:</strong> {{ order.surname }}</p>
        <p><strong>State:</strong> {{ order.state }}</p>
        <p><strong>Zip/Postal Code:</strong> {{ order.zip }}</p>
        <p><strong>Gift? </strong> {{ order.gift }}</p>
        <p><strong>Deliver to address: </strong> {{ order.method }}</p>

        <button v-on:click="submitCheckoutForm">Place Order</button>
      </div>
    </div>

    <script type="text/javascript">
      let webstore = new Vue({
        el: "#app",
        data: {
          showLessons: true,
          ascendingOrder: true,
          sortOption: 'price',
          sitename: "Afterschool activities",
          lessons: lessons,
          order: {
            name: "",
            surname: "",
            address: "",
            city: "",
            zip: "",
            state: "",
            gift: "Do not send as a gift",
            method: "Home",
            sendGift: "Send as a gift",
            dontSendGift: "Do not send as a gift",
          },
          cart: [],
          states: {
            AL: "Alabama",
            AR: "Arizona",
            CA: "California",
            NV: "Nevada",
          },
        },
        computed: {
          cartItemCount: function () {
            return this.cart.length || "";
          },
          sortedLessons() {
            let sortedArray = [...this.lessons];

            if (this.sortOption === "price") {
              sortedArray.sort((a, b) => a.price - b.price);
            } else if (this.sortOption === "location") {
              sortedArray.sort((a, b) => a.location.localeCompare(b.location));
            } else if (this.sortOption === "subject") {
              sortedArray.sort((a, b) => a.subject.localeCompare(b.subject));
            } else if (this.sortOption === "space") {
              sortedArray.sort((a, b) => a.availableSpaces - b.availableSpaces);
            }

            if (!this.ascendingOrder) {
              sortedArray.reverse();
            }

            return sortedArray;
          }
        },
        methods: {
          addToCart: function (lesson) {
            this.cart.push(lesson.id);
          },
          selectSortingOption: function (option) {
            this.sortOption = option;
          },
          setAscendingOrder: function () {
            this.ascendingOrder = true;
          },
          setDescendingOrder: function () {
            this.ascendingOrder = false;
          },
          showCheckout() {
            this.showLessons = this.showLessons ? false : true;
          },
          submitCheckoutForm() {
            alert("Order submitted!");
          },
          canAddToCart: function (lesson) {
            return lesson.availableSpaces > this.cartLessonCount(lesson.id);
          },
          canSwitchPages: function () {
            return this.cart.length > 0;
          },
          cartLessonCount: function (lessonId) {
            let count = 0;
            for (let i = 0; i < this.cart.length; i++) {
              if (this.cart[i] === lessonId) {
                count++;
              }
            }
            return count;
          },
          lessonSpacesLeft(lesson) {
            return lesson.availableSpaces - this.cartLessonCount(lesson.id);
          },
        },
      });
    </script>
  </body>
</html>